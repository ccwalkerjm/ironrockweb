<!DOCTYPE html>
<html lang="en" class="no-js">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="MobileOptimized" content="320">
    <title>IronRock Insurance</title>

    <!--    @Scripts.Render("~/bundles/modernizr")-->
    <!--@Styles.Render("~/bundles/GlobalCSS")-->
    <link href="/assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/assets/plugins/uniform/css/uniform.default.css" rel="stylesheet">
    <link href="/assets/plugins/bootstrap-datepicker/css/datepicker.css" rel="stylesheet">
    <!--    @Styles.Render("~/bundles/ThemeCSS")-->
    <link href="/assets/css/style-metronic.css" rel="stylesheet">
    <link href="/assets/css/style.css" rel="stylesheet">
    <link href="/assets/css/style-responsive.css" rel="stylesheet">
    <link href="/assets/css/plugins.css" rel="stylesheet">
    <link href="/assets/css/pages/tasks.css" rel="stylesheet">
    <link href="/assets/css/themes/default.css" rel="stylesheet">
    <link href="/assets/css/custom.css" rel="stylesheet">
    <link href="/assets/plugins/select2/select2_metro.css" rel="stylesheet">
    <!--@Scripts.Render("~/bundles/jquery")-->
    <script src="/Scripts/jquery-2.2.3.js"></script>
    <script src="/assets/plugins/jquery-migrate-1.2.1.min.js"></script>
    <script src="/assets/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js"></script>
    <script src="/assets/scripts/app.js"></script>
    <script src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="/assets/plugins/bootstrap-hover-dropdown/twitter-bootstrap-hover-dropdown.min.js"></script>
    <script src="/assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <script src="/assets/plugins/jquery.blockui.min.js"></script>
    <script src="/assets/plugins/jquery.cokie.min.js"></script>
    <script src="/assets/plugins/uniform/jquery.uniform.min.js"></script>
    <script src="/assets/plugins/select2/select2.min.js"></script>

</head>

<body class="page-header-fixed">
    <div class="header navbar navbar-inverse navbar-fixed-top" style="background-color:rgb(231,231,231)!important;min-height:60px">
        <div class="header-inner">
            <a class="navbar-brand" href="/index.html">
                <img src="/assets/img/logo.png" id="logo" alt="" class="img-responsive" />
            </a>

            <a href="javascript:;" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <img src="/assets/img/menu-toggler.png" alt="" />
            </a>

            <ul class="nav navbar-nav pull-right">
            </ul>

        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
            </ul>
        </div>
    </div>
    <div class="clearfix" />

    <div class="page-container">
        <div class="page-sidebar-wrapper" id="sidebar"></div>
        <div class="page-content-wrapper">
            <div class="page-content">
                <h1>Quotes</h1>

                <div class="row">
                    <div class="col-md-4">
                        <h2>Quote Search</h2>
                        <form role="form">
                            <div class="form-group">
                                <label for="quoteNo">Quote No:</label>
                                <input type="number" class="form-control" id="quoteNo">
                            </div>
                            <div class="form-group">
                                <label for="ident">ID No:</label>
                                <input type="number" class="form-control" id="ident">
                            </div>
                            <div class="form-group">
                                <label for="firstname">First Name:</label>
                                <input type="text" class="form-control" id="firstname">
                            </div>
                            <div class="form-group">
                                <label for="lastname">Last Name:</label>
                                <input type="text" class="form-control" id="lastname">
                            </div>
                            <div class="form-group">
                                <label for="dateFr">Date From:</label>
                                <input type="date" class="form-control" id="dateFr">
                            </div>
                            <div class="form-group">
                                <label for="dateTo">Date To:</label>
                                <input type="date" class="form-control" id="dateTo">
                            </div>
                            <div class="form-group">
                                <label for="insuranceType">Type:</label>
                                <select class="form-control" id="insuranceType">
                                    <option value="motor">Motor Vehicle</option>
                                    <option value="property">Home Property</option>
                                </select>
                            </div>
                            <button type="button" class="btn btn-default" id="doSearch">Submit</button>
                        </form>
                    </div>
                    <div class="col-md-4">
                        <h2>Quotes</h2>
                        <table class="table" id="quotesTable">
                            <thead>
                                <tr>
                                    <td>Quote Number</td>
                                    <td>First Name</td>
                                    <td>Last Name</td>
                                    <td>Type</td>
                                    <td></td>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="footer" style="background-color:rgb(231,231,231)!important">
        <div class="footer-inner">
            2016 &copy; Ironrock Insurance.
        </div>
        <div class="footer-tools">
            <span class="go-top">
			    <i class="fa fa-angle-up"></i>
		    </span>
        </div>
    </div>



    <script src="/Scripts/bootbox.js"></script>
    <!--Required Libraries-->
    <script src="/aws/jsbn.js"></script>
    <script src="/aws/jsbn2.js"></script>
    <script src="/aws/sjcl.js"></script>
    <script src="/aws/moment.min.js"></script>
    <script src="/aws/aws-cognito-sdk.min.js"></script>
    <script src="/aws/amazon-cognito-identity.min.js"></script>
    <script src="/aws/aws-sdk-2.3.19.min.js"></script>
    <!--Iron Rock Custom Library-->
    <script src="/aws/ironrockcloudservice.js"></script>
    <script src="/Scripts/jspdf.min.js"></script>
    <script src="/Scripts/basic.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#sidebar').load("/sideBarAuthorised.html", function () {
                App.init();
                var ir = new ironrockcloudservice();


                ir.init(function () {
                    var username = ir.getUsername();
                    if (username) {
                        $('#sidebar #globalUsername').text(username);
                        var today = new Date();
                        var yyyy = today.getFullYear();
                        var lastYear = yyyy - 1;
                        $('#dateFr').val(lastYear + '-01-01');
                        $('#dateTo').val(yyyy + '-12-31');
                    } else {
                        location.assign('/login.html');
                    }
                });


                $('#sidebar').on('click', '#logout', function () {
                    ir.signoff();
                    location.assign('/index.html');
                })


                function getBaseUrl() {
                    var re = new RegExp(/^.*\//);
                    return re.exec(window.location.href);
                }

                $('#doSearch').click(function () {
                    var searchData = {};

                    searchData.quoteNo = $('#quoteNo').val();
                    searchData.IdNum = $('#ident').val();
                    searchData.firstName = $('#firstname').val();
                    searchData.lastName = $('#lastname').val();
                    searchData.dateFr = $('#dateFr').val();
                    searchData.dateTo = $('#dateTo').val();
                    searchData.type = $('#insuranceType').val();
                    var payload = JSON.stringify(searchData);

                    ir.searchQuotes(payload, function (err, resp) {
                        if (err) {
                            alert("error: " + err.statusText);
                            return;
                        }
                        resp = JSON.parse(resp);
                        var quotes = resp.sort(function (a, b) {
                            return b.id - a.id;
                        });
                        // ascending order

                        var dlTable = $('#quotesTable tbody').html('');
                        $.each(quotes, function (idx, r) {
                            var data = r.request; // JSON.parse(r.request);
                            dlTable.append('<tr><td>' + r.id + '</td><td>' +
                                data.FirstName + '</td><td>' +
                                data.applicantSurname + '</td><td>' +
                                data.insuranceType + '</td><td><button class="btn btn-link select" id="' + r.id + '">Select</button></td></tr>');
                        })
                    });

                });


                $('#quotesTable tbody').on('click', '.select', function (e) {
                    var id = e.target.id;
                    ir.getQuote(id, function (err, resp) {
                        if (err) {
                            alert("error: " + err.statusText);
                            return;
                        }
                        resp = JSON.parse(resp);
                        console.log(resp);
                        var doc = new jsPDF();
                        doc.setFontSize(22);
                        doc.text(20, 20, 'Proposal');

                        doc.setFontSize(16);
                        doc.text(20, 30, 'Insurance for ' + resp.insuranceType);

                        doc.text(20, 40, 'Name ' + resp.FirstName + " " + resp.applicantSurname);

                        doc.save('Proposal' + id + '.pdf');


                    });
                })


            });

        });
    </script>




</body>

</html>